<!doctype html>
<link rel='stylesheet' href='/stylesheets/chat.css'>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<div>
	<h1><%= room.name %></h1>
</div>

<ul class='timeline' id='timeline'>
</ul>

<form action="">
    <input id = "message"/>
    <button class="btn btn-success">Send</button>
</form>

  
  
<script>
  	var socket = io();

  	$('form').submit(function(){
    		socket.emit('send', <%- JSON.stringify(user) %>, <%= room.id %>, $('#message').val());	
    		$('#message').val('');
    		return false;
  	});

	socket.on('send', function(sender, msg){
		var str = "<li>";
		str += "<img class='timeline-badge' src=\"" + sender.photo +"\"/>";	
		str += "<div class='timeline-panel'>";
		str += "<div class='timeline-body'>";
		str += msg
		str += "</div>";
		str += "<p><small class='text-muted'><i class='glyphicon glyphicon-time'></i> "+ sender.name +"</small></p>";
		str += "</div>";
		str += "</li>";
		
		$('#timeline').append(str);
	});
	
	$( document ).ready(function() { 
   		 socket.emit('join', <%= room.id %>);
	});
</script>


